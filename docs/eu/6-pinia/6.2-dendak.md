# 6.2 Pinia-n Dendak Sortzea eta Erabiltzea

## Zer da Denda (Store) bat?

Pinia-n, denda batek egoera eta negozio-logika biltzen ditu. Vuex-ek ez bezala, ez dituzu mutazioak behar; ekintzak (actions) nahikoa dira.

## Zure lehen denda sortzea

1. Sortu dendarako fitxategi bat, adibidez `stores/counter.js`:

```javascript
import { defineStore } from 'pinia'

// Composition API sintaxia erabiliz (gomendatua Vue 3-rako)
export const useCounterStore = defineStore('counter', () => {
  // Egoera erreaktiboa
  const count = ref(0)
  const name = ref('Kontagailua')
  const data = ref(null)
  
  // Getters (kalkulatuak)
  const doubleCount = computed(() => count.value * 2)
  const greeting = computed(() => `Kaixo, ${name.value}. Kontagailua ${count.value} da`)
  
  // Ekintzak (metodoak)
  function increment() {
    count.value++
  }
  
  async function fetchData() {
    try {
      const response = await fetch('https://api.example.com/data')
      const result = await response.json()
      data.value = result
      return result
    } catch (error) {
      console.error('Datuak kargatzerakoan errorea:', error)
      throw error
    }
  }
  
  return {
    // Egoera
    count,
    name,
    data,
    
    // Getters
    doubleCount,
    greeting,
    
    // Ekintzak
    increment,
    fetchData
  }
})
```

## Denda bat osagaian erabiltzea

```vue
<template>
  <div>
    <h1>{{ name }}</h1>
    <p>Kontagailua: {{ count }}</p>
    <p>Bikoitia: {{ doubleCount }}</p>
    <p>{{ greeting }}</p>
    
    <button @click="handitu">Handitu</button>
    <button @click="berrezarri">Berrezarri</button>
    
    <div v-if="kargatzen">Datuak kargatzen...</div>
    <div v-else-if="errorea">Errorea: {{ errorea }}</div>
    <pre v-else-if="store.data">{{ store.data }}</pre>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { storeToRefs } from 'pinia'
import { useCounterStore } from '@/stores/counter'

const store = useCounterStore()
const kargatzen = ref(false)
const errorea = ref(null)

// Egoera eta getter-ren desegituraketa erreaktiboa
const { count, name, doubleCount, greeting } = storeToRefs(store)

// Ekintzen desegituraketa
const { increment: handitu } = store

// Kontagailua berrezartzeko funtzioa
const berrezarri = () => store.$reset()

// Datuak kargatu osagaia muntatzean
onMounted(async () => {
  try {
    kargatzen.value = true
    errorea.value = null
    await store.fetchData()
  } catch (err) {
    errorea.value = err.message || 'Errorea datuak kargatzean'
  } finally {
    kargatzen.value = false
  }
})
</script>
```

## Desegituratze Erreaktiboa

Erreaktibitatea mantentzeko desegituratzean, erabili `storeToRefs`:

```vue
<script setup>
import { storeToRefs } from 'pinia'
import { useCounterStore } from '@/stores/counter'

const store = useCounterStore()
// Honek erreaktibitatea mantenduko du
const { count, name } = storeToRefs(store)
// Ekintzak zuzenean desegitura daitezke
const { increment } = store
</script>
```

## Egoera berrezartzea

Egoera hasierako balioetara edozein unetan berrezar dezakezu:

```javascript
const store = useStore()
store.$reset()
```

## Aldaketetara harpidetza

Egoerako aldaketetara harpidetu zaitezke:

```javascript
store.$subscribe((mutation, state) => {
  // Aldaketa bakoitzaren ondoren exekutatzen da
  console.log('Aldaketa detektatua:', mutation, state)
})
```

Oinarrizko kontzeptu hauekin, modu eraginkorrean hasi zaitezke zure Vue aplikazioaren egoera Pinia-rekin kudeatzen.

## Hurrengo urratsa

Pinia-ko denden oinarriak ikasi ondoren, hurrengo pausoa da [Pinia-ko Gai Aurreratuak](./6.3-aurreratua.md) aztertzea; bertan, egoeraren persistentzia, testing-a, Vue Router-ekin integrazioa eta gehiago ikusiko dituzu.
