# 6.3 Pinia-ko Gai Aurreratuak

## Egoeraren Persistentzioa

Orria birkargatzean egoera mantentzeko, erabili `pinia-plugin-persistedstate`:

```bash
npm install pinia-plugin-persistedstate
```

Aplikazioan konfigurazioa:

```javascript
import { createPinia } from 'pinia'
import piniaPluginPersistedstate from 'pinia-plugin-persistedstate'

const pinia = createPinia()
pinia.use(piniaPluginPersistedstate)

app.use(pinia)
```

Ondoren, zure dendan:

```javascript
export const useStore = defineStore('main', {
  state: () => ({
    user: null,
    preferences: {},
  }),
  persist: true, // Egoera osoa persistitu
  // Edo kontrol gehiagoz:
  persist: {
    paths: ['user'], // Erabiltzailea soilik persistitu
    storage: sessionStorage, // localStorage-ren ordez sessionStorage erabili
  },
})
```

## Moduluak eta Habiaratutako Dendak

Zure logika hainbat dendatan antola dezakezu eta elkarrekin erabili:

```javascript
// stores/user.js
export const useUserStore = defineStore('user', {
  state: () => ({
    name: 'Erabiltzailea',
    isAuthenticated: false,
  }),
  actions: {
    login() {
      this.isAuthenticated = true
    },
  },
})

// stores/cart.js
export const useCartStore = defineStore('cart', {
  state: () => ({
    items: [],
  }),
  actions: {
    addItem(item) {
      this.items.push(item)
    },
  },
})

// Osagai batean
import { useUserStore } from '@/stores/user'
import { useCartStore } from '@/stores/cart'

export default {
  setup() {
    const user = useUserStore()
    const cart = useCartStore()
    
    // Bi dendak batera erabili
    const checkout = () => {
      if (user.isAuthenticated) {
        // Erosketa prozesatu
      } else {
        // Login-era birbideratu
      }
    }
    
    return { user, cart, checkout }
  },
}
```

## Pinia-rekin Testing-a

Zure dendak probatzeko, erabili `@vue/test-utils` Pinia-rekin batera:

```bash
npm install -D @vue/test-utils @vue/vue3-jest
```

Proba adibidea:

```javascript
import { setActivePinia, createPinia } from 'pinia'
import { useCounterStore } from '@/stores/counter'

describe('Counter Store', () => {
  beforeEach(() => {
    // Proba bakoitzaren aurretik Pinia instantzia berria sortu
    setActivePinia(createPinia())
  })

  it('kontagailua handitzen du', () => {
    const store = useCounterStore()
    expect(store.count).toBe(0)
    store.increment()
    expect(store.count).toBe(1)
  })
})
```

## Vue Router-ekin Integrazioa

Pinia Vue Router-ekin batera erabil dezakezu nabigazio babestua egiteko:

```javascript
// router/index.js
import { createRouter, createWebHistory } from 'vue-router'
import { useUserStore } from '@/stores/user'

const routes = [
  {
    path: '/dashboard',
    component: () => import('@/views/Dashboard.vue'),
    meta: { requiresAuth: true }
  },
  // Beste ibilbide batzuk...
]

const router = createRouter({
  history: createWebHistory(),
  routes,
})

router.beforeEach((to, from, next) => {
  const userStore = useUserStore()
  
  if (to.meta.requiresAuth && !userStore.isAuthenticated) {
    next('/login')
  } else {
    next()
  }
})

export default router
```

## TypeScript-ekin Erabilera

Pinia-k lehen mailako euskarria du TypeScript-erako. Hona hemen denda tipatu baten adibidea:

```typescript
// types/user.ts
export interface User {
  id: number
  name: string
  email: string
}

// stores/user.ts
import { defineStore } from 'pinia'
import type { User } from '@/types/user'

interface UserState {
  user: User | null
  loading: boolean
  error: string | null
}

export const useUserStore = defineStore('user', {
  state: (): UserState => ({
    user: null,
    loading: false,
    error: null,
  }),
  
  actions: {
    async fetchUser(userId: number) {
      this.loading = true
      this.error = null
      
      try {
        const response = await fetch(`/api/users/${userId}`)
        const data: User = await response.json()
        this.user = data
      } catch (error) {
        this.error = error instanceof Error ? error.message : 'Errore ezezaguna'
      } finally {
        this.loading = false
      }
    },
  },
  
  getters: {
    isAdmin: (state): boolean => {
      return state.user?.role === 'admin'
    },
  },
})
```

Kontzeptu aurreratu hauekin, ahalik eta gehien aprobetxa dezakezu Pinia zure Vue 3 aplikazioetan.

## Hurrengo urratsa

Pinia-ko gai aurreratuak ikasi ondoren, hurrengo pausoa da [Proiektuaren Egitura](../7-proiektua/7.1-egitura.md) aztertzea; han ikusiko duzu nola integratu ikasitakoa aplikazio oso batean.
