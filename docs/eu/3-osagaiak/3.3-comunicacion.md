# 3.2 Osagaien arteko Komunikazioa

Vue aplikazioetan, osagaiek elkarren artean komunikatu behar dute. Hemen komunikazio-patroi desberdinak ikusiko ditugu.

## 1. Props-ak (Gurasoa → Semea)

Props-ek guraso osagai batetik seme-alaba osagai batera datuak pasatzea ahalbidetzen dute.

**Guraso Osagaia (GurasoOsagaia.vue):**
```vue
<template>
  <div>
    <h1>Zereginen Zerrenda</h1>
    <zeregin-zerrenda 
      :zereginak="zereginak" 
      @zeregina-osatua="markatuOsatutakoModuan" 
    />
  </div>
</template>

<script>
import { ref } from 'vue';
import ZereginZerrenda from './ZereginZerrenda.vue';

export default {
  components: { ZereginZerrenda },
  setup() {
    const zereginak = ref([
      { id: 1, testua: 'Vue ikasi', osatua: false },
      { id: 2, testua: 'Erosketak egin', osatua: true },
      { id: 3, testua: 'Ariketa egin', osatua: false }
    ]);

    function markatuOsatutakoModua(id) {
      const zeregina = zereginak.value.find(z => z.id === id);
      if (zeregina) {
        zeregina.osatua = !zeregina.osatua;
      }
    }

    return { zereginak, markatuOsatutakoModua };
  }
};
</script>
```

**Seme-alaba Osagaia (ZereginZerrenda.vue):**
```vue
<template>
  <ul>
    <li 
      v-for="zeregina in zereginak" 
      :key="zeregina.id"
      :class="{ 'osatua': zeregina.osatua }"
      @click="aldatuZeregina(zeregina.id)"
    >
      {{ zeregina.testua }}
    </li>
  </ul>
</template>

<script>
export default {
  props: {
    zereginak: {
      type: Array,
      required: true
    }
  },
  emits: ['zeregina-osatua'],
  setup(props, { emit }) {
    function aldatuZeregina(id) {
      emit('zeregina-osatua', id);
    }

    return { aldatuZeregina };
  }
};
</script>

<style scoped>
.osatua {
  text-decoration: line-through;
  opacity: 0.7;
}
</style>
```

## 2. Gertaera Pertsonalizatuak (Semea → Gurasoa)

Gertaera pertsonalizatuek seme-alaba osagaiei beraien gurasoekin komunikatzeko aukera ematen diete. Goiko adibidean, `@zeregina-osatua` gertaera erabiltzen dugu nola gurasoari jakinarazteko zeregin baten egoera aldatu dela.

## 3. Provide/Inject (Sakoneko Komunikazioa)

Oso erabilgarria da datuak maila askotako osagaien artean pasatzeko props-ak erabili gabe.

**Aitona Osagaia (App.vue):**
```vue
<template>
  <div>
    <h1>Zereginen Aplikazioa</h1>
    <zeregin-kudeatzailea />
  </div>
</template>

<script>
import { provide, ref } from 'vue';
import ZereginKudeatzailea from './ZereginKudeatzailea.vue';

export default {
  components: { ZereginKudeatzailea },
  setup() {
    const zereginak = ref([]);
    
    function gehituZeregina(testua) {
      zereginak.value.push({
        id: Date.now(),
        testua,
        osatua: false
      });
    }
    
    // Datuak eman beheko osagaientzat
    provide('zereginak', zereginak);
    provide('gehituZeregina', gehituZeregina);
    
    return { zereginak };
  }
};
</script>
```

**Seme-alaba Osagaia (ZereginZerrenda.vue):**
```vue
<template>
  <div>
    <ul>
      <zeregin-item 
        v-for="zeregina in zereginak" 
        :key="zeregina.id" 
        :zeregina="zeregina"
      />
    </ul>
  </div>
</template>

<script>
import { inject } from 'vue';
import ZereginItem from './ZereginItem.vue';

export default {
  components: { ZereginItem },
  setup() {
    const zereginak = inject('zereginak');
    return { zereginak };
  }
};
</script>
```

## 4. Anaien arteko Komunikazioa

### Event Bus erabiliz (Diseinu-patroia)

```javascript
// eventBus.js
import { createApp } from 'vue';
export const eventBus = createApp({});
```

**Bidaltzaile Osagaia:**
```vue
<template>
  <button @click="bidaliMezua">Bidali Mezua</button>
</template>

<script>
import { eventBus } from '../eventBus';

export default {
  setup() {
    function bidaliMezua() {
      eventBus.config.globalProperties.$emit('mezua', 'Kaixo bidaltzaile osagaitik!');
    }
    
    return { bidaliMezua };
  }
};
</script>
```

**Hartzaile Osagaia:**
```vue
<template>
  <div>
    <p>Jasotako mezua: {{ mezua }}</p>
  </div>
</template>

<script>
import { ref, onMounted, onUnmounted } from 'vue';
import { eventBus } from '../eventBus';

export default {
  setup() {
    const mezua = ref('');
    
    function kudeatuMezua(jasotakoMezua) {
      mezua.value = jasotakoMezua;
    }
    
    onMounted(() => {
      eventBus.config.globalProperties.$on('mezua', kudeatuMezua);
    });
    
    onUnmounted(() => {
      eventBus.config.globalProperties.$off('mezua', kudeatuMezua);
    });
    
    return { mezua };
  }
};
</script>
```

## 5. Ariketa Praktikoa: Zereginen Kudeatzailea

Sortu zereginen kudeatzaile bat hurrengo osagaiekin:

- `ZereginZerrenda`: Zereginen zerrenda erakusten du eta zereginak osatutzat markatzeko aukera ematen du
- `ZereginBerria`: Zeregin berriak gehitzeko formularioa
- `ZereginElementua`: Zeregin bakarra erakusten du eta ezabatzeko aukera ematen du
- `ZereginIragazkia`: Zereginak iragazteko aukerak (guztiak, osatu gabeak, osatuak)

### Adibidearen erabilera

```vue
<template>
  <div class="zeregin-app">
    <h1>Zereginen Zerrenda</h1>
    <zeregin-berria @gehitu-zeregina="gehituZeregina" />
    <zeregin-iragazkia :iragazkia="unekoIragazkia" @eguneratu-iragazkia="ezarriIragazkia" />
    <zeregin-zerrenda 
      :zereginak="iragazitakoZereginak" 
      @ezabatu-zeregina="ezabatuZeregina"
      @aldatu-egoera="aldatuZereginarenEgoera"
    />
  </div>
</template>

<script>
import { ref, computed } from 'vue';
import ZereginZerrenda from './ZereginZerrenda.vue';
import ZereginBerria from './ZereginBerria.vue';
import ZereginIragazkia from './ZereginIragazkia.vue';

export default {
  components: {
    ZereginZerrenda,
    ZereginBerria,
    ZereginIragazkia
  },
  setup() {
    const zereginak = ref([
      { id: 1, testua: 'Vue ikasi', osatua: false },
      { id: 2, testua: 'Erosketak egin', osatua: true },
      { id: 3, testua: 'Ariketa fisikoa egin', osatua: false }
    ]);

    const unekoIragazkia = ref('guztiak');

    const iragazitakoZereginak = computed(() => {
      if (unekoIragazkia.value === 'osatuak') {
        return zereginak.value.filter(z => z.osatua);
      } else if (unekoIragazkia.value === 'osatuGabeak') {
        return zereginak.value.filter(z => !z.osatua);
      }
      return zereginak.value;
    });

    function gehituZeregina(zereginBerria) {
      zereginak.value.push({
        id: Date.now(),
        testua: zereginBerria,
        osatua: false
      });
    }

    function ezabatuZeregina(id) {
      zereginak.value = zereginak.value.filter(z => z.id !== id);
    }

    function aldatuZereginarenEgoera(id) {
      const zeregina = zereginak.value.find(z => z.id === id);
      if (zeregina) {
        zeregina.osatua = !zeregina.osatua;
      }
    }

    function ezarriIragazkia(iragazkia) {
      unekoIragazkia.value = iragazkia;
    }

    return {
      zereginak,
      unekoIragazkia,
      iragazitakoZereginak,
      gehituZeregina,
      ezabatuZeregina,
      aldatuZereginarenEgoera,
      ezarriIragazkia
    };
  }
};
</script>

<style scoped>
.zeregin-app {
  max-width: 600px;
  margin: 0 auto;
  padding: 20px;
  font-family: Arial, sans-serif;
}

h1 {
  color: #2c3e50;
  text-align: center;
}
</style>
```

### ZereginBerria.vue

```vue
<template>
  <form @submit.prevent="bidaliZeregina" class="zeregin-berria">
    <input 
      v-model="zereginBerria"
      type="text" 
      placeholder="Idatzi zeregin berri bat..."
      required
    >
    <button type="submit">Gehitu</button>
  </form>
</template>

<script>
export default {
  emits: ['gehitu-zeregina'],
  setup(props, { emit }) {
    const zereginBerria = ref('');

    function bidaliZeregina() {
      if (zereginBerria.value.trim()) {
        emit('gehitu-zeregina', zereginBerria.value.trim());
        zereginBerria.value = '';
      }
    }

    return {
      zereginBerria,
      bidaliZeregina
    };
  }
};
</script>

<style scoped>
.zeregin-berria {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
}

input {
  flex: 1;
  padding: 8px;
  border: 1px solid #ddd;
  border-radius: 4px;
}

button {
  padding: 8px 16px;
  background-color: #42b983;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

button:hover {
  background-color: #3aa876;
}
</style>
```

### ZereginZerrenda.vue

```vue
<template>
  <ul class="zeregin-zerrenda">
    <zeregin-elementua
      v-for="zeregina in zereginak"
      :key="zeregina.id"
      :zeregina="zeregina"
      @ezabatu="ezabatuZeregina(zeregina.id)"
      @aldatu-egoera="aldatuZereginarenEgoera(zeregina.id)"
    />
  </ul>
</template>

<script>
import ZereginElementua from './ZereginElementua.vue';

export default {
  components: { ZereginElementua },
  props: {
    zereginak: {
      type: Array,
      required: true
    }
  },
  emits: ['ezabatu-zeregina', 'aldatu-egoera'],
  setup(props, { emit }) {
    function ezabatuZeregina(id) {
      emit('ezabatu-zeregina', id);
    }

    function aldatuZereginarenEgoera(id) {
      emit('aldatu-egoera', id);
    }

    return {
      ezabatuZeregina,
      aldatuZereginarenEgoera
    };
  }
};
</script>

<style scoped>
.zeregin-zerrenda {
  list-style: none;
  padding: 0;
  margin: 0;
}
</style>
```

### ZereginElementua.vue

```vue
<template>
  <li class="zeregin-elementua" :class="{ 'osatua': zeregina.osatua }">
    <input 
      type="checkbox" 
      :checked="zeregina.osatua"
      @change="$emit('aldatu-egoera')"
    >
    <span class="zeregin-testua">{{ zeregina.testua }}</span>
    <button 
      class="ezabatu-botoia"
      @click="$emit('ezabatu')"
      aria-label="Ezabatu"
    >
      ×
    </button>
  </li>
</template>

<script>
export default {
  props: {
    zeregina: {
      type: Object,
      required: true
    }
  },
  emits: ['aldatu-egoera', 'ezabatu']
};
</script>

<style scoped>
.zeregin-elementua {
  display: flex;
  align-items: center;
  padding: 10px;
  border: 1px solid #eee;
  margin-bottom: 8px;
  border-radius: 4px;
  background-color: white;
}

.zeregin-elementua:hover {
  background-color: #f9f9f9;
}

.zeregin-testua {
  margin-left: 10px;
  flex-grow: 1;
}

.osatua .zeregin-testua {
  text-decoration: line-through;
  opacity: 0.7;
}

.ezabatu-botoia {
  background: none;
  border: none;
  color: #ff6b6b;
  font-size: 20px;
  cursor: pointer;
  padding: 0 5px;
  line-height: 1;
  opacity: 0;
  transition: opacity 0.2s;
}

.zeregin-elementua:hover .ezabatu-botoia {
  opacity: 1;
}

input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
}
</style>
```

### ZereginIragazkia.vue

```vue
<template>
  <div class="zeregin-iragazkia">
    <button
      v-for="aukera in aukerak"
      :key="aukera.parametroa"
      @click="aldatuIragazkia(aukera.parametroa)"
      :class="{ aktiboa: aukera.parametroa === iragazkia }"
    >
      {{ aukera.etxekoa }}
    </button>
  </div>
</template>

<script>
export default {
  props: {
    iragazkia: {
      type: String,
      required: true,
      validator: (value) => ['guztiak', 'osatuGabeak', 'osatuak'].includes(value)
    }
  },
  emits: ['eguneratu-iragazkia'],
  setup(props, { emit }) {
    const aukerak = [
      { parametroa: 'guztiak', etxekoa: 'Guztiak' },
      { parametroa: 'osatuGabeak', etxekoa: 'Osatu gabeak' },
      { parametroa: 'osatuak', etxekoa: 'Osatuak' }
    ];

    function aldatuIragazkia(iragazkiBerria) {
      emit('eguneratu-iragazkia', iragazkiBerria);
    }

    return {
      aukerak,
      aldatuIragazkia
    };
  }
};
</script>

<style scoped>
.zeregin-iragazkia {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
  justify-content: center;
}

button {
  padding: 5px 10px;
  border: 1px solid #ddd;
  background: white;
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s;
}

button:hover {
  border-color: #42b983;
  color: #42b983;
}

.aktiboa {
  background-color: #42b983;
  color: white;
  border-color: #42b983;
}
</style>
```

## Berrikuspen Galderak

1. Nola pasatzen dira datuak guraso osagai batetik seme-alaba osagai batera?
2. Nola komunika daiteke seme-alaba osagai bat bere gurasoarekin?
3. Zer da "prop drilling" eta nola saihestu daiteke aplikazio handiagoetan?
4. Noiz da egokia provide/inject erabiltzea prop-ak erabili ordez?

## Hurrengo Urratsa

Orain dela jakin duzu nola komunikatzen diren osagaiak elkarren artean Vue-n, ordua da ikustea nola inplementatu nabigazioa zure aplikazioan.

[→ Hurrengoa: Nabigazioa Vue-n](../5-vue-router/5.1-sarrera.md)
