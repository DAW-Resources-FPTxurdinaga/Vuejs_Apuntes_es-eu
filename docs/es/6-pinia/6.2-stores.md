# Creación y Uso de Stores en Pinia

## ¿Qué es un Store?

En Pinia, un store es una entidad que contiene estado y lógica de negocio. A diferencia de Vuex, no necesitas mutaciones, solo acciones.

## Creando tu primer Store

1. Crea un archivo para el store, por ejemplo `stores/counter.js`:

```javascript
import { defineStore } from 'pinia'

// Usando la sintaxis de Composition API (recomendado para Vue 3)
export const useCounterStore = defineStore('counter', () => {
  // Estado reactivo
  const count = ref(0)
  const name = ref('Contador')
  const data = ref(null)
  
  // Getters (computadas)
  const doubleCount = computed(() => count.value * 2)
  const greeting = computed(() => `Hola, ${name.value}. El contador es ${count.value}`)
  
  // Acciones (métodos)
  function increment() {
    count.value++
  }
  
  async function fetchData() {
    try {
      const response = await fetch('https://api.example.com/data')
      const result = await response.json()
      data.value = result
      return result
    } catch (error) {
      console.error('Error al cargar datos:', error)
      throw error
    }
  }
  
  return {
    // Estado
    count,
    name,
    data,
    
    // Getters
    doubleCount,
    greeting,
    
    // Acciones
    increment,
    fetchData
  }
})
```

## Usando el Store en un Componente

```vue
<template>
  <div>
    <h1>{{ name }}</h1>
    <p>Contador: {{ count }}</p>
    <p>Doble: {{ doubleCount }}</p>
    <p>{{ greeting }}</p>
    
    <button @click="increment">Incrementar</button>
    <button @click="reset">Reiniciar</button>
    
    <div v-if="loading">Cargando datos...</div>
    <div v-else-if="error">Error: {{ error }}</div>
    <pre v-else-if="store.data">{{ store.data }}</pre>
  </div>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { storeToRefs } from 'pinia'
import { useCounterStore } from '@/stores/counter'

const store = useCounterStore()
const loading = ref(false)
const error = ref(null)

// Desestructuración reactiva del estado y getters
const { count, name, doubleCount, greeting } = storeToRefs(store)

// Desestructuración de acciones
const { increment } = store

// Función para reiniciar el contador
const reset = () => store.$reset()

// Cargar datos al montar el componente
onMounted(async () => {
  try {
    loading.value = true
    error.value = null
    await store.fetchData()
  } catch (err) {
    error.value = err.message || 'Error al cargar los datos'
  } finally {
    loading.value = false
  }
})
</script>
```

## Desestructuración Reactiva

Para mantener la reactividad al desestructurar, usa `storeToRefs`:

```vue
<script setup>
import { storeToRefs } from 'pinia'
import { useCounterStore } from '@/stores/counter'

const store = useCounterStore()
// Esto mantendrá la reactividad
const { count, name } = storeToRefs(store)
// Las acciones pueden ser desestructuradas directamente
const { increment } = store
</script>
```

## Resetear el estado

Puedes resetear el estado a sus valores iniciales en cualquier momento:

```javascript
const store = useStore()
store.$reset()
```

## Suscripción a cambios

Puedes suscribirte a los cambios en el estado:

```javascript
store.$subscribe((mutation, state) => {
  // Se ejecuta después de cada cambio
  console.log('Cambio detectado:', mutation, state)
})
```

Con estos conceptos básicos, ya puedes empezar a gestionar el estado de tu aplicación Vue con Pinia de manera efectiva.

## Siguiente paso

Ahora que has aprendido los conceptos básicos de los stores en Pinia, el siguiente paso es explorar [Conceptos Avanzados de Pinia](.\/6.3-avanzado.md), donde aprenderás sobre persistencia de estado, testing, integración con Vue Router y más.
